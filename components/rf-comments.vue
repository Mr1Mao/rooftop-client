<template>
  <div class="container">
    <client-only>
      <el-divider></el-divider>
      <p class="title">è¯„è®º</p>
      <div class="my-comments">
        <el-avatar
          icon="el-icon-user-solid"
          :src="$store.state.userInfo.avatar"
          :size="40"
          class="rf-avatar"
        ></el-avatar>
        <div class="textarea">
          <el-input
            type="textarea"
            :rows="4"
            placeholder="æœ‰ä»€ä¹ˆæƒ³è¯´çš„å’Œå¤§å®¶åˆ†äº«ä¸€ä¸‹å­..."
            v-model="textarea"
          >
          </el-input>
          <div class="btns">
            <el-button type="primary" size="default" @click="submit()" round
              >å‘å¸ƒ</el-button
            >
            <el-button type="info" size="default" @click="cancel()" round plain
              >å–æ¶ˆ</el-button
            >
          </div>
        </div>
      </div>
      <p class="title">å…¨éƒ¨è¯„è®º</p>
      <div class="comments-box" v-for="item in 5" :key="item">
        <el-avatar
          icon="el-icon-user-solid"
          :src="$store.state.userInfo.avatar"
          :size="40"
          class="rf-avatar"
        ></el-avatar>
        <div class="comment">
          <div class="comment-info">
            <div class="from">Mao</div>
            <div class="time">2021-03-15 17:29:08</div>
          </div>
          <div class="content">
            â€œå»å¹´ä¸€æ»´ç›¸æ€æ³ªï¼Œä»Šå¹´å°¤æŒ‚ä¸¤è…®è¾¹â€â€”â€”åŸæ¥è„¸è¿˜å¯ä»¥é•¿åˆ°è¿™ç§ç¨‹åº¦ğŸ˜‚,â€œå»å¹´ä¸€æ»´ç›¸æ€æ³ªï¼Œä»Šå¹´å°¤æŒ‚ä¸¤è…®è¾¹â€â€”â€”åŸæ¥è„¸è¿˜å¯ä»¥é•¿åˆ°è¿™ç§ç¨‹åº¦ğŸ˜‚,
            â€œå»å¹´ä¸€æ»´ç›¸æ€æ³ªï¼Œä»Šå¹´å°¤æŒ‚ä¸¤è…®è¾¹â€â€”â€”åŸæ¥è„¸è¿˜å¯ä»¥é•¿åˆ°è¿™ç§ç¨‹åº¦ğŸ˜‚
          </div>
          <div class="interaction">
            <div class="item">
              <i class="el-icon-star-off"> 66 </i>
              <!-- el-icon-star-on -->
            </div>
            <div class="item">
              <i class="el-icon-s-comment" @click="dialogVisible = true">
                æŸ¥çœ‹å›å¤
              </i>
            </div>
            <div class="item hover">
              <i class="el-icon-s-promotion" @click="showReplyBox(String(item))">
                {{ replayBoxAction == item ? "å–æ¶ˆå›å¤" : "å›å¤" }}
              </i>
            </div>
            <div class="item hover">
              <i class="el-icon-s-flag"> ä¸¾æŠ¥ </i>
            </div>
          </div>

          <!-- å›å¤æ¡† -->
         <transition name="el-zoom-in-top">
            <rf-reply-box replyTo="Mao" :toId="String(item)" :actionId.sync = "replayBoxAction" :isCancelBtn="true"></rf-reply-box>
          </transition>

          <el-divider></el-divider>
        </div>
      </div>
      <!-- æŸ¥çœ‹å›å¤å¯¹è¯æ¡† -->
      <el-dialog
        title="æŸ¥çœ‹å›å¤(108)"
        :visible.sync="dialogVisible"
        top="3vh"
        custom-class="reply-dialog-box"
      >
        <!-- å†…å®¹ -->
        <div class="content-dialog" :style="{'height':clientHeight * 0.83 + 7 + 'px'}">
          <!-- å›å¤ä¸­çš„è¯„è®ºå¤´åƒ -->
          <div style="display: flex">
            <!-- å¤´åƒ -->
            <el-avatar
              icon="el-icon-user-solid"
              :src="$store.state.userInfo.avatar"
              :size="30"
            ></el-avatar>
            <!-- è¯„è®º & ä¿¡æ¯ -->
            <div style="flex: 1; margin: 0 10px">
              <div style="line-height: 30px">
                <p class="name-dialog fr">2021-03-15 17:29:08</p>
                <p>Mao</p>
              </div>
              <div class="comment-content-dialog">
                â€œå»å¹´ä¸€æ»´ç›¸æ€æ³ªï¼Œä»Šå¹´å°¤æŒ‚ä¸¤è…®è¾¹â€â€”â€”åŸæ¥è„¸è¿˜å¯ä»¥é•¿åˆ°è¿™ç§ç¨‹åº¦ğŸ˜‚,
                â€œå»å¹´ä¸€æ»´ç›¸æ€æ³ªï¼Œä»Šå¹´å°¤æŒ‚ä¸¤è…®è¾¹â€â€”â€”åŸæ¥è„¸è¿˜å¯ä»¥é•¿åˆ°è¿™ç§ç¨‹åº¦ğŸ˜‚,
                â€œå»å¹´ä¸€æ»´ç›¸æ€æ³ªï¼Œä»Šå¹´å°¤æŒ‚ä¸¤è…®è¾¹â€â€”â€”åŸæ¥è„¸è¿˜å¯ä»¥é•¿åˆ°è¿™ç§ç¨‹åº¦ğŸ˜‚
              </div>
            </div>
          </div>

          <!-- äº’åŠ¨æ“ä½œæŒ‰é’® -->
          <div class="dialog-interaction">
            <div class="item">
              <i class="el-icon-star-off"> 66 </i>
              <!-- el-icon-star-on -->
            </div>
            <div class="item">
              <i class="el-icon-s-promotion" @click="showReplyBox('111')">
                {{ replayBoxAction == '111' ? "å–æ¶ˆå›å¤" : "å›å¤" }}
              </i>
            </div>
            <div class="item">
              <i class="el-icon-s-flag"> ä¸¾æŠ¥ </i>
            </div>
          </div>

          <!-- å›å¤æ¡† -->
          <transition name="el-zoom-in-top">
            <rf-reply-box style="margin-left: 40px" replyTo="Mao" toId="111" :actionId.sync = "replayBoxAction"></rf-reply-box>
          </transition>

          <el-divider></el-divider>
          
          <div
            class="reply-list"
            v-infinite-scroll="load"
            infinite-scroll-disabled="disabled"
            infinite-scroll-distance="5"
            style="overflow: auto; margin-right: -3px;"
          >
            <!-- <p style="color: #232323">108 æ¡å›å¤</p> -->
            <div v-for="i in count" :key="i" class="list-item">
              <div style="display: flex">
                <!-- å¤´åƒ -->
                <el-avatar
                  icon="el-icon-user-solid"
                  :src="$store.state.userInfo.avatar"
                  :size="30"
                ></el-avatar>
                <!-- è¯„è®º & ä¿¡æ¯ -->
                <div style="flex: 1; margin: 0 10px">
                  <div style="line-height: 30px">
                    <p class="name-dialog fr">2021-03-15 17:29:08</p>
                    <p>Mao</p>
                  </div>
                  <div class="comment-content-dialog">
                    â€œå»å¹´ä¸€æ»´ç›¸æ€æ³ªï¼Œä»Šå¹´å°¤æŒ‚ä¸¤è…®è¾¹â€â€”â€”åŸæ¥è„¸è¿˜å¯ä»¥é•¿åˆ°è¿™ç§ç¨‹åº¦ğŸ˜‚,
                    {{ i }}
                  </div>
                  <!-- äº’åŠ¨æ“ä½œæŒ‰é’® -->
                  <div class="dialog-interaction">
                    <div class="item">
                      <i class="el-icon-star-off"> 66 </i>
                      <!-- el-icon-star-on -->
                    </div>
                    <div class="item">
                      <i
                        class="el-icon-s-promotion"
                        @click="showReplyBox(String(i), 'reply')"
                      >
                        {{ replayDailogAction == String(i) ? "å–æ¶ˆå›å¤" : "å›å¤" }}
                      </i>
                    </div>
                    <div class="item">
                      <i class="el-icon-s-flag"> ä¸¾æŠ¥ </i>
                    </div>
                  </div>
                  <!-- "å¯¹è¯„è®ºçš„å›å¤"å›å¤æ¡† -->
                  <transition name="el-zoom-in-top">
                    <rf-reply-box :replyTo="String(i)" :toId="String(i)" :actionId.sync="replayDailogAction" ></rf-reply-box>
                  </transition>
                  <el-divider></el-divider>
                </div>
              </div>
            </div>
            <div style="">
              <p v-if="loading" class="ac">åŠ è½½ä¸­...</p>
              <p v-if="noMore" class="ac">æ²¡æœ‰æ›´å¤šäº†</p>
            </div>
          </div>
        </div>
      </el-dialog>
    </client-only>
  </div>
</template>

<script>
import rfReplyBox from './rf-reply-box.vue';
export default {
  components: { rfReplyBox },
  //è·å–å±å¹•é«˜åº¦
  mounted(height) {
    if (process.client) {
      this.clientHeight = `${document.documentElement.clientHeight}`; //document.body.clientWidth;
      //console.log(self.clientHeight);
      let _this = this
      window.onresize = function temp() {
        _this.clientHeight = `${document.documentElement.clientHeight}`;
      };
    }
  },
  data() {
    return {
      textarea: "",
      replayBoxAction: '-1',
      dialogVisible: false,
      count: 10,
      loading: false,
      replayDailogAction: '-1',
      replyTextarea: "",
      clientHeight: '',
      // replyTitle:"å›å¤"
    };
  },
  methods: {
    /**
     * æ‰“å¼€å›å¤æ¡†
     * type å›å¤å¯¹è±¡
     */
    showReplyBox(index, type) {
      if (type == "reply") {
        if (this.replayDailogAction != '-1' && this.replayDailogAction == index) {
          this.replayDailogAction = '-1';
        } else {
          this.replayDailogAction = index;
        }
        return;
      }

      if (this.replayBoxAction != '-1' && this.replayBoxAction == index) {
        this.replayBoxAction = '-1';
      } else {
        this.replayBoxAction = index;
      }
    },
    cancelReply(type) {
      // if (type == "reply") {
      //   this.replayDailogAction = -1;
      // } else {
      //   this.replayBoxAction = -1;
      // }
    },
    load() {
      this.loading = true;
      setTimeout(() => {
        console.log("æ‰§è¡Œäº†ä¸€æ¬¡", this.count);
        this.count += 5;
        this.loading = false;
      }, 1000);
    },
  },
  computed: {
    noMore() {
      return this.count >= 40;
    },
    disabled() {
      return this.loading || this.noMore;
    },
  },
};
</script>

<style lang="scss" scoped>
.container {
  font: {
    size: 1rem;
    weight: 600;
    family: $def_font_family;
  }

  .title {
    font-size: 1.3rem;
  }

  .rf-avatar {
    margin: 0 20px;
  }
  .my-comments {
    // width: 800px;
    // margin: 0 auto;
    padding: 30px 0;
    display: flex;
    .textarea {
      flex: 1;
      .btns {
        margin: 10px 0;
        float: right;
      }
    }
  }
  .item {
    cursor: pointer;
    padding: 0 10px;
    color: gray;
    font: {
      size: 0.9rem;
      weight: 800;
    }
    &:hover {
      color: #232323;
    }
  }
  .comments-box {
    padding: 30px 0 0 0;
    display: flex;

    &:hover .hover {
      display: block !important;
    }

    .comment {
      flex: 1;
      .comment-info {
        height: 40px;
      }
      .content {
        padding: 20px 0 20px 0;
        font: {
          weight: 400;
        }
      }
      .interaction {
        // float: right;
        display: flex;
        flex-direction: row-reverse;

        .hover {
          display: none;
          // color: aqua;
        }
      }

     
    }
  }
  .content-dialog {

    display: flex;
    flex-direction: column;
    .reply-list {
      .comment-content-dialog {
        font: {
          weight: 400;
        }
        margin: 10px 0 0 0;
      }
    }

    .dialog-interaction {
      display: flex;
      flex-direction: row-reverse;
      margin-top: 10px;
    }
    .reply {
      margin-top: 5px;
    }
    .el-divider {
      margin: 15px 0;
    }

    .list-item {
      margin: 10px 10px 10px 0;
    }
  }
}
</style>
<style >
.el-dialog__body {
  padding: 10px 20px;
}
</style>

